# Sesi√≥n 10 Octubre 2025 - Arquitectura Invoice + MasterPart + Estrategia de Datos Compartidos

**Fecha**: 10 Octubre 2025
**Branch**: `develop`
**Commit base**: `489d3a0` - Sistema de alertas premium funcionando

---

## üéØ Contexto de la Sesi√≥n

### Input del Cliente (Responsable Mantenimiento):

**Pregunta clave**: ¬øC√≥mo se facturan los servicios de mantenimiento?

**Respuesta**:
> "En la factura de compra del servicio (ej: cambio de filtro de aceite) se discrimina cada elemento con su costo, pero **NO se agrega la mano de obra**."

**Ejemplos reales**:
```
Factura Proveedor XYZ - Cambio aceite motor:
- Aceite Shell Helix 5W-40 (4L)    $140,000
- Filtro aceite BOSCH               $45,000
- Arandela tap√≥n c√°rter             $2,000
                          TOTAL:    $187,000

‚ùå NO incluye: "Mano de obra $50,000"
```

### Implicaciones:
1. **No necesitamos inventario propio** - Solo cat√°logo de referencia
2. **S√≠ necesitamos master de art√≠culos** - Para vincular factura con item trabajo
3. **S√≠ necesitamos discriminar** - MantItem tipo "Acci√≥n" vs "Repuesto"
4. **S√≠ necesitamos hist√≥rico de precios** - Por art√≠culo + proveedor

---

## üí° Estrategia de Negocio CLAVE

### Visi√≥n del Pitch de Ventas:

> "No vendemos tecnolog√≠a. Vendemos AHORRO y CONTROL DE COSTOS."

**Preguntas que el sistema debe responder** (vendedoras de software):
1. ‚úÖ ¬øCu√°nto invertimos en este veh√≠culo este a√±o?
2. ‚úÖ ¬øQu√© proveedor cobra menos por filtros?
3. ‚úÖ Listado de compras: art√≠culo, precio, proveedor, qui√©n autoriz√≥
4. ‚úÖ ¬øPresupuesto necesario para l√≠nea Toyota en 2026?
5. ‚úÖ ¬øConviene Toyota o Nissan? (TCO - Total Cost of Ownership)
6. ‚úÖ ¬øEste veh√≠culo est√° bien o mal mantenido?
7. ‚úÖ **IA sugeriendo plan de acci√≥n para abaratar costos** ü§ñ

**Diferenciador vs Competencia**:
- Competencia: "Tenemos m√≥dulo de mantenimiento"
- Nosotros: "Le mostramos que Proveedor B le cobra 15% m√°s y le ahorramos $2.3M/a√±o"

---

## üèóÔ∏è Arquitectura Propuesta - Fase por Fase

### üìä Decisiones de Dise√±o Fundamentales:

#### 1. ¬øUn MantItem puede tener m√∫ltiples art√≠culos?
**DECISI√ìN**: **S√ç** - No limitarnos.

**Raz√≥n**:
- "Cambio aceite motor" incluye: aceite + filtro + arandela
- "Mantenimiento 5,000 km" incluye: 8-10 art√≠culos diferentes

**Soluci√≥n**: Tabla intermedia `MantItemPart` (many-to-many)

#### 2. ¬øMantItem necesita discriminaci√≥n de tipo?
**DECISI√ìN**: **S√ç** - Agregar enum `ItemType`

**Tipos**:
- `ACTION` - Inspecci√≥n, revisi√≥n (no factura art√≠culo)
- `PART` - Repuesto facturable (filtro, aceite, etc.)
- `SERVICE` - Servicio completo externo (mano obra + materiales del proveedor)

#### 3. ¬øNecesitamos hist√≥rico de precios por proveedor?
**DECISI√ìN**: **S√ç** - `PartPriceHistory`

**Raz√≥n**: Responder "¬øQu√© proveedor cobra menos?" y detectar aumentos abusivos.

#### 4. ¬øCampo observaciones t√©cnicas en alertas?
**DECISI√ìN**: **S√ç** - `MantItem.technicalNotes`

**Ejemplo**:
> "Debe colocarse aceite SAE 5W-40 sint√©tico. NO usar mineral."

**Beneficio**:
- ‚úÖ T√©cnico sabe exactamente qu√© necesita
- ‚ùå Previene errores ‚Üí evita correctivos $$$

---

## üìê Schema Prisma Completo

### Dise√±o Incremental: MVP ‚Üí Premium

```prisma
// ============================================
// FASE 1: MVP (Sprint 1.5) - LO M√çNIMO VIABLE
// ============================================

enum ItemType {
  ACTION   // Inspecci√≥n, revisi√≥n (no factura art√≠culo)
  PART     // Repuesto facturable
  SERVICE  // Servicio completo del proveedor
}

// 1. Master de Art√≠culos (Cat√°logo compartido entre tenants)
model MasterPart {
  id              String   @id @default(cuid())
  tenantId        String?  // NULL = compartido globalmente, FK = espec√≠fico del tenant

  // Identificaci√≥n
  code            String   @unique  // "BOSCH-123", "SHELL-5W40-SYNT"
  description     String              // "Filtro aceite motor BOSCH"
  category        String              // "FILTROS", "ACEITES", "LUBRICANTES"
  subcategory     String?             // "FILTROS_ACEITE", "FILTROS_AIRE"
  unit            String   @default("UNIDAD")  // "UNIDAD", "LITRO", "GAL√ìN", "KG"

  // Precio referencia (√∫ltimo conocido)
  referencePrice  Float?
  lastPriceUpdate DateTime?

  // Specs t√©cnicas (JSON flexible para futuro)
  specifications  Json?    // { "viscosity": "5W-40", "type": "synthetic", "apiRating": "SN/CF" }

  // Alternativas/Equivalentes (FASE 2)
  alternativeFor  String?  // FK a otro MasterPart (ej: gen√©rico equivalente)
  alternativePart MasterPart? @relation("Alternatives", fields: [alternativeFor], references: [id], onDelete: SetNull)
  alternatives    MasterPart[] @relation("Alternatives")

  // Metadata
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relaciones
  mantItemParts   MantItemPart[]
  invoiceItems    InvoiceItem[]
  priceHistory    PartPriceHistory[]
  compatibilities PartCompatibility[]  // FASE 3

  @@index([category])
  @@index([tenantId])
  @@index([code])
}

// 2. MantItem extendido con discriminaci√≥n de tipo
model MantItem {
  id              String   @id @default(cuid())
  templateId      String
  template        MaintenanceTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)

  // ... campos actuales (name, description, intervalKm, estimatedHours, priority, etc.) ...

  // NUEVO: Discriminaci√≥n de tipo
  type            ItemType  @default(ACTION)

  // NUEVO: Costo estimado (suma autom√°tica de parts o manual)
  estimatedCost   Float?

  // NUEVO: Recomendaciones t√©cnicas para el t√©cnico
  technicalNotes  String?   @db.Text  // "Debe colocarse aceite SAE 5W-40 sint√©tico"

  // Relaciones
  parts           MantItemPart[]  // Items tipo PART vinculan art√≠culos
  programItems    VehicleProgramItem[]
  workOrderItems  WorkOrderItem[]

  @@index([templateId])
  @@index([type])
}

// 3. Tabla intermedia: MantItem ‚Üî MasterPart (many-to-many)
model MantItemPart {
  id            String   @id @default(cuid())
  mantItemId    String
  mantItem      MantItem @relation(fields: [mantItemId], references: [id], onDelete: Cascade)
  masterPartId  String
  masterPart    MasterPart @relation(fields: [masterPartId], references: [id], onDelete: Restrict)

  quantity      Float    @default(1)  // Ej: 4.5 litros de aceite
  isRequired    Boolean  @default(true)  // Requerido vs opcional
  isPrimary     Boolean  @default(false) // Art√≠culo principal del item

  // Notas espec√≠ficas de este vinculo
  notes         String?  // "Alternativamente usar CASTROL 5W-40"

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([mantItemId, masterPartId])
  @@index([mantItemId])
  @@index([masterPartId])
}

// 4. MaintenanceAlert extendido (hereda info t√©cnica)
model MaintenanceAlert {
  // ... campos actuales ...

  // NUEVO: Info t√©cnica heredada de MantItem al generarse
  technicalNotes    String?  @db.Text  // Copiado de MantItem.technicalNotes
  recommendedParts  Json?    // Snapshot de parts recomendados al momento de generar alerta

  // NUEVO: Admin puede agregar notas espec√≠ficas del caso
  customNotes       String?  @db.Text  // "En este veh√≠culo usar 10W-40 por clima extremo"
}

// 5. Invoice (Factura del proveedor)
model Invoice {
  id              String   @id @default(cuid())
  tenantId        String
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  // Identificaci√≥n factura
  invoiceNumber   String   // N√∫mero de factura del proveedor
  invoiceDate     DateTime // Fecha emisi√≥n factura
  dueDate         DateTime? // Fecha vencimiento pago

  // Proveedor
  supplierId      String
  supplier        Supplier @relation(fields: [supplierId], references: [id], onDelete: Restrict)

  // Vinculaci√≥n con trabajo (opcional si factura es de WO)
  workOrderId     String?
  workOrder       WorkOrder? @relation(fields: [workOrderId], references: [id], onDelete: SetNull)

  // Montos
  subtotal        Float
  taxAmount       Float    @default(0)
  totalAmount     Float
  currency        String   @default("COP")

  // Estado
  status          InvoiceStatus @default(PENDING)

  // Aprobaci√≥n y auditor√≠a
  approvedBy      String?
  approver        User?    @relation("InvoiceApprover", fields: [approvedBy], references: [id], onDelete: SetNull)
  approvedAt      DateTime?

  registeredBy    String   // Usuario que registr√≥ la factura
  registrar       User     @relation("InvoiceRegistrar", fields: [registeredBy], references: [id], onDelete: Restrict)

  // Notas y adjuntos
  notes           String?  @db.Text
  attachmentUrl   String?  // URL a factura escaneada/PDF

  // Metadata
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relaciones
  items           InvoiceItem[]
  payments        InvoicePayment[]  // FASE 2
  priceHistory    PartPriceHistory[]

  @@unique([tenantId, invoiceNumber])
  @@index([tenantId])
  @@index([supplierId])
  @@index([workOrderId])
  @@index([status])
  @@index([invoiceDate])
}

enum InvoiceStatus {
  PENDING      // Registrada, pendiente aprobaci√≥n
  APPROVED     // Aprobada para pago
  PAID         // Pagada
  OVERDUE      // Vencida
  CANCELLED    // Cancelada
}

// 6. InvoiceItem (L√≠nea de factura - granular)
model InvoiceItem {
  id              String   @id @default(cuid())
  invoiceId       String
  invoice         Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  // Vinculaci√≥n con cat√°logo (CLAVE para analytics)
  masterPartId    String?  // Nullable: permite registrar sin cat√°logo inicialmente
  masterPart      MasterPart? @relation(fields: [masterPartId], references: [id], onDelete: SetNull)

  // Vinculaci√≥n con trabajo realizado (traza: alerta ‚Üí WO ‚Üí factura)
  workOrderItemId String?
  workOrderItem   WorkOrderItem? @relation(fields: [workOrderItemId], references: [id], onDelete: SetNull)

  // Datos de factura (lo que dice el documento f√≠sico)
  description     String   // Texto exacto de la factura
  quantity        Float
  unitPrice       Float    // Precio real pagado
  subtotal        Float
  taxRate         Float    @default(0)
  taxAmount       Float    @default(0)
  total           Float

  // Metadata
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([invoiceId])
  @@index([masterPartId])
  @@index([workOrderItemId])
}

// 7. Hist√≥rico de precios por art√≠culo + proveedor (GOLD MINE para analytics)
model PartPriceHistory {
  id              String   @id @default(cuid())
  tenantId        String   // Precios son espec√≠ficos del tenant

  // Art√≠culo
  masterPartId    String
  masterPart      MasterPart @relation(fields: [masterPartId], references: [id], onDelete: Cascade)

  // Proveedor
  supplierId      String
  supplier        Supplier @relation(fields: [supplierId], references: [id], onDelete: Restrict)

  // Precio y contexto
  price           Float
  quantity        Float    @default(1)  // Por si aplican descuentos por volumen
  recordedAt      DateTime @default(now())

  // Auditor√≠a (RESPONDE: "¬øQui√©n autoriz√≥ esta compra?")
  invoiceId       String?
  invoice         Invoice? @relation(fields: [invoiceId], references: [id], onDelete: SetNull)
  approvedBy      String?
  approver        User?    @relation(fields: [approvedBy], references: [id], onDelete: SetNull)
  purchasedBy     String?  // Usuario que gestion√≥ la compra
  purchaser       User?    @relation(fields: [purchasedBy], references: [id], onDelete: SetNull)

  // Metadata
  createdAt       DateTime @default(now())

  @@index([masterPartId, supplierId])
  @@index([tenantId])
  @@index([recordedAt])
  @@index([approvedBy])
}

// ============================================
// FASE 2: Post-MVP (Sprint 2-3) - ANALYTICS PREMIUM
// ============================================

// 8. Pagos de facturas (control financiero)
model InvoicePayment {
  id              String   @id @default(cuid())
  invoiceId       String
  invoice         Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  amount          Float
  paymentDate     DateTime
  paymentMethod   String   // "TRANSFERENCIA", "CHEQUE", "EFECTIVO"
  referenceNumber String?  // N√∫mero de transferencia/cheque

  registeredBy    String
  registrar       User     @relation(fields: [registeredBy], references: [id], onDelete: Restrict)

  notes           String?
  createdAt       DateTime @default(now())

  @@index([invoiceId])
  @@index([paymentDate])
}

// ============================================
// FASE 3: Premium (Sprint 4+) - IA Y OPTIMIZACI√ìN
// ============================================

// 9. Compatibilidad de art√≠culos por veh√≠culo (para sugerir alternativas)
model PartCompatibility {
  id              String   @id @default(cuid())
  masterPartId    String
  masterPart      MasterPart @relation(fields: [masterPartId], references: [id], onDelete: Cascade)

  // Filtros de compatibilidad (NULL = aplica a todos)
  brand           String?   // "Toyota"
  model           String?   // "Hilux"
  yearFrom        Int?      // 2020
  yearTo          Int?      // 2024
  engineType      String?   // "Diesel 2.8L", "Gasolina 2.7L"
  transmission    String?   // "Manual", "Autom√°tica"

  // Nivel de compatibilidad
  compatibility   CompatibilityLevel @default(COMPATIBLE)

  notes           String?  @db.Text
  verifiedBy      String?  // Usuario que verific√≥ compatibilidad
  verifiedAt      DateTime?

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([masterPartId])
  @@index([brand, model])
}

enum CompatibilityLevel {
  RECOMMENDED   // OEM o recomendado fabricante
  COMPATIBLE    // Compatible gen√©rico
  CONDITIONAL   // Compatible bajo condiciones
  INCOMPATIBLE  // No compatible
}

// ============================================
// MODIFICACIONES A MODELOS EXISTENTES
// ============================================

// WorkOrder - Agregar relaci√≥n con Invoice
model WorkOrder {
  // ... campos actuales ...

  // NUEVO: Relaci√≥n con facturas
  invoices        Invoice[]
}

// WorkOrderItem - Agregar relaci√≥n con InvoiceItem
model WorkOrderItem {
  // ... campos actuales ...

  // NUEVO: Relaci√≥n con items de factura
  invoiceItems    InvoiceItem[]
}

// Supplier - Agregar relaciones
model Supplier {
  // ... campos actuales ...

  // NUEVO: Relaciones
  invoices        Invoice[]
  priceHistory    PartPriceHistory[]
}

// User - Agregar relaciones de auditor√≠a
model User {
  // ... campos actuales ...

  // NUEVO: Auditor√≠a de compras
  invoicesApproved    Invoice[] @relation("InvoiceApprover")
  invoicesRegistered  Invoice[] @relation("InvoiceRegistrar")
  priceHistoryApproved PartPriceHistory[]
  priceHistoryPurchased PartPriceHistory[] @relation("PurchasedBy")
  paymentsRegistered   InvoicePayment[]
}
```

---

## üîÑ Flujo Completo: Alerta ‚Üí Factura ‚Üí Analytics

### Ejemplo Real Paso a Paso:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. SETUP INICIAL (Admin configura template)                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Admin crea MaintenanceTemplate "Paquete 5,000 km Toyota Hilux"
  ‚îî‚îÄ MantItem #1: "Cambio aceite motor"
       ‚îú‚îÄ type: PART
       ‚îú‚îÄ technicalNotes: "Debe colocarse aceite SAE 5W-40 sint√©tico"
       ‚îú‚îÄ estimatedCost: 187,000 (suma de parts)
       ‚îî‚îÄ parts:
           ‚îú‚îÄ MantItemPart #1:
           ‚îÇ   ‚îú‚îÄ masterPart: "SHELL-5W40-SYNT" (Aceite Shell Helix Ultra)
           ‚îÇ   ‚îú‚îÄ quantity: 4.5
           ‚îÇ   ‚îú‚îÄ isRequired: true
           ‚îÇ   ‚îî‚îÄ isPrimary: true
           ‚îú‚îÄ MantItemPart #2:
           ‚îÇ   ‚îú‚îÄ masterPart: "BOSCH-FILTER-123" (Filtro aceite)
           ‚îÇ   ‚îú‚îÄ quantity: 1
           ‚îÇ   ‚îî‚îÄ isRequired: true
           ‚îî‚îÄ MantItemPart #3:
               ‚îú‚îÄ masterPart: "WASHER-M14" (Arandela)
               ‚îú‚îÄ quantity: 1
               ‚îî‚îÄ isRequired: false

  ‚îî‚îÄ MantItem #2: "Inspecci√≥n visual frenos"
       ‚îú‚îÄ type: ACTION (sin parts vinculados)
       ‚îî‚îÄ estimatedHours: 0.5

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2. GENERACI√ìN AUTOM√ÅTICA DE ALERTA                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Chofer registra od√≥metro: 5,020 km
  ‚Üì
MaintenanceAlertService.checkAndGenerateAlerts()
  ‚Üì
MaintenanceAlert creada:
  ‚îú‚îÄ programItemId: FK a VehicleProgramItem
  ‚îú‚îÄ status: ACTIVE
  ‚îú‚îÄ priority: CRITICAL
  ‚îú‚îÄ estimatedCost: 187,000 (heredado)
  ‚îú‚îÄ technicalNotes: "Debe colocarse aceite SAE 5W-40 sint√©tico" (copiado)
  ‚îî‚îÄ recommendedParts: [snapshot JSON de parts]

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 3. ADMIN VE ALERTA EN UI                                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Navega a /dashboard/maintenance/alerts
  ‚Üì
Ve tabla compacta:
‚îå‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îê
‚îÇ‚òê‚îÇüöó‚îÇBCD-890  ‚îÇüî¥1     ‚îÇ5,020 km‚îÇ20 km   ‚îÇ$187k   ‚îÇ1.5 hrs ‚îÇ‚ñº‚îÇ
‚îî‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îò
  ‚Üì
Click expandir:
  üìã Recomendaci√≥n t√©cnica:
  "Debe colocarse aceite SAE 5W-40 sint√©tico"

  üì¶ Art√≠culos requeridos:
  ‚úì Aceite Shell Helix Ultra 5W-40 (4.5 L) - $140,000
  ‚úì Filtro aceite BOSCH-123 (1 un) - $45,000
  ‚óã Arandela tap√≥n c√°rter M14 (1 un) - $2,000 (opcional)

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 4. CREACI√ìN DE WORKORDER                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Admin selecciona alertas ‚Üí Click "Crear Orden de Trabajo"
  ‚Üì
WorkOrder #5 creada:
  ‚îú‚îÄ vehicleId: "vehicle-123" (Toyota Hilux BCD-890)
  ‚îú‚îÄ status: PENDING
  ‚îú‚îÄ totalEstimatedCost: 187,000
  ‚îî‚îÄ items:
      ‚îî‚îÄ WorkOrderItem #1:
          ‚îú‚îÄ mantItemId: "mant-item-123" (Cambio aceite motor)
          ‚îú‚îÄ maintenanceAlertId: "alert-456"
          ‚îú‚îÄ estimatedCost: 187,000
          ‚îî‚îÄ technicalNotes: "Debe colocarse aceite SAE 5W-40..."

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 5. EJECUCI√ìN DEL TRABAJO                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

T√©cnico ejecuta trabajo en taller externo
Proveedor "AutoServicio XYZ" entrega factura f√≠sica

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 6. REGISTRO DE FACTURA (Admin)                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Admin ingresa factura al sistema:

Invoice:
  ‚îú‚îÄ invoiceNumber: "F-001234"
  ‚îú‚îÄ supplierId: "autoservicio-xyz"
  ‚îú‚îÄ workOrderId: "wo-5" (vincula con WO)
  ‚îú‚îÄ invoiceDate: 2025-10-10
  ‚îú‚îÄ subtotal: 187,000
  ‚îú‚îÄ taxAmount: 0
  ‚îú‚îÄ totalAmount: 187,000
  ‚îú‚îÄ status: PENDING
  ‚îú‚îÄ registeredBy: "user-admin"
  ‚îî‚îÄ items:
      ‚îú‚îÄ InvoiceItem #1:
      ‚îÇ   ‚îú‚îÄ masterPartId: "SHELL-5W40-SYNT" (seleccionado de dropdown)
      ‚îÇ   ‚îú‚îÄ workOrderItemId: "woi-789" (vincula con item de WO)
      ‚îÇ   ‚îú‚îÄ description: "Aceite Shell Helix Ultra 5W-40 sint√©tico"
      ‚îÇ   ‚îú‚îÄ quantity: 4.5
      ‚îÇ   ‚îú‚îÄ unitPrice: 31,111 (140k / 4.5)
      ‚îÇ   ‚îî‚îÄ total: 140,000
      ‚îú‚îÄ InvoiceItem #2:
      ‚îÇ   ‚îú‚îÄ masterPartId: "BOSCH-FILTER-123"
      ‚îÇ   ‚îú‚îÄ workOrderItemId: "woi-789"
      ‚îÇ   ‚îú‚îÄ description: "Filtro aceite BOSCH"
      ‚îÇ   ‚îú‚îÄ quantity: 1
      ‚îÇ   ‚îú‚îÄ unitPrice: 45,000
      ‚îÇ   ‚îî‚îÄ total: 45,000
      ‚îî‚îÄ InvoiceItem #3:
          ‚îú‚îÄ masterPartId: "WASHER-M14"
          ‚îú‚îÄ workOrderItemId: "woi-789"
          ‚îú‚îÄ quantity: 1
          ‚îú‚îÄ unitPrice: 2,000
          ‚îî‚îÄ total: 2,000

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 7. ACTUALIZACI√ìN AUTOM√ÅTICA DE HIST√ìRICO (Trigger DB)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Sistema crea PartPriceHistory autom√°ticamente:

PartPriceHistory #1:
  ‚îú‚îÄ masterPartId: "SHELL-5W40-SYNT"
  ‚îú‚îÄ supplierId: "autoservicio-xyz"
  ‚îú‚îÄ price: 31,111
  ‚îú‚îÄ invoiceId: "invoice-123"
  ‚îú‚îÄ approvedBy: "user-admin"
  ‚îî‚îÄ recordedAt: 2025-10-10

PartPriceHistory #2:
  ‚îú‚îÄ masterPartId: "BOSCH-FILTER-123"
  ‚îú‚îÄ supplierId: "autoservicio-xyz"
  ‚îú‚îÄ price: 45,000
  ‚îî‚îÄ ...

Sistema actualiza MasterPart.referencePrice:
  - SHELL-5W40-SYNT: $31,111 (actualizado)
  - BOSCH-FILTER-123: $45,000 (actualizado)

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 8. ANALYTICS Y REPORTES (Killer Features)                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Ahora admin puede consultar:

üîç Query 1: "Hist√≥rico de precios - Filtro BOSCH-123"
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Fecha        ‚îÇ Proveedor       ‚îÇ Precio   ‚îÇ Autorizado ‚îÇ Factura      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 2025-10-10   ‚îÇ AutoServicio XYZ‚îÇ $45,000  ‚îÇ Juan P√©rez ‚îÇ F-001234     ‚îÇ
‚îÇ 2025-08-15   ‚îÇ Repuestos ABC   ‚îÇ $42,000  ‚îÇ Juan P√©rez ‚îÇ F-000987     ‚îÇ
‚îÇ 2025-06-20   ‚îÇ AutoServicio XYZ‚îÇ $46,500  ‚îÇ Mar√≠a L√≥pez‚îÇ F-000756     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
üí° Insight: Proveedor ABC cobra 7% menos ‚Üí Ahorro potencial

üîç Query 2: "¬øCu√°nto gastamos en Toyota Hilux BCD-890 en 2025?"
Total: $4,250,000
Desglose:
  - Aceites: $840,000 (6 cambios)
  - Filtros: $450,000
  - Frenos: $980,000
  - Neum√°ticos: $1,980,000

üîç Query 3: "Comparar TCO: Toyota vs Nissan"
Toyota Hilux (promedio 30 veh√≠culos): $2,100,000/a√±o
Nissan Frontier (promedio 15 veh√≠culos): $2,800,000/a√±o
üí° Diferencia: Toyota 33% m√°s eficiente ‚Üí $700k ahorro/a√±o

ü§ñ Query 4: "IA sugiere acci√≥n" (FASE 3)
Detect√© 3 oportunidades de ahorro:
1. Cambiar a Proveedor ABC en filtros ‚Üí $180,000/a√±o
2. Usar aceite sint√©tico de larga duraci√≥n ‚Üí $320,000/a√±o
3. Mantenimientos preventivos evitar√≠an $1,200,000 en correctivos
TOTAL AHORRO POTENCIAL: $1,700,000/a√±o
```

---

## üöÄ Estrategia de Datos Compartidos (GAME CHANGER)

### Visi√≥n del Modelo de Negocio:

> **"El sufrimiento de carga de la primera empresa beneficia a todas las siguientes."**

### Implementaci√≥n:

```prisma
model MasterPart {
  tenantId  String?  // NULL = dato global compartido
                     // FK = dato espec√≠fico del tenant
}
```

### L√≥gica de Compartici√≥n:

```typescript
// Al buscar art√≠culos, unir globales + espec√≠ficos del tenant
const parts = await prisma.masterPart.findMany({
  where: {
    OR: [
      { tenantId: null },           // Globales (todos)
      { tenantId: currentTenantId } // Espec√≠ficos del tenant
    ],
    category: 'FILTROS_ACEITE'
  }
})
```

### Ejemplo Pr√°ctico:

```
EMPRESA A (Primera - Transportes Andinos):
‚îî‚îÄ Tiene Toyota Hilux 2024
‚îî‚îÄ Admin carga manualmente:
    ‚îú‚îÄ MasterPart: "BOSCH-FILTER-123" (tenantId: NULL ‚Üí global)
    ‚îú‚îÄ MasterPart: "SHELL-5W40-SYNT" (tenantId: NULL ‚Üí global)
    ‚îî‚îÄ MaintenanceTemplate "Paquete 5000 km Toyota Hilux 2024"
        ‚îî‚îÄ MantItems vinculados a parts globales

EMPRESA B (Segunda - Log√≠stica del Valle):
‚îî‚îÄ Tiene Toyota Hilux 2024
‚îî‚îÄ Al crear template, sistema sugiere:
    üí° "Detectamos template compatible: Paquete 5000 km Toyota Hilux 2024"
    üí° "¬øDesea importarlo?"
    ‚îî‚îÄ Admin: "S√≠" ‚Üí Template copiado autom√°ticamente
    ‚îî‚îÄ MasterParts ya existen (globales) ‚Üí 0 carga manual

EMPRESA C (Tercera - Entregas R√°pidas):
‚îî‚îÄ Tiene Toyota Hilux 2024
‚îî‚îÄ Template YA EXISTE ‚Üí Onboarding instant√°neo
‚îî‚îÄ Solo configura su flota ‚Üí 5 minutos vs 2 horas
```

### Datos Globales vs Espec√≠ficos:

**GLOBALES (tenantId = NULL)** - Compartidos:
- ‚úÖ MasterPart (art√≠culos gen√©ricos)
- ‚úÖ PartCompatibility (compatibilidades vehiculares)
- ‚úÖ MaintenanceTemplate (plantillas base por marca/modelo)

**ESPEC√çFICOS (tenantId = FK)** - Privados:
- üîí Vehicles (flota del cliente)
- üîí WorkOrder (√≥rdenes del cliente)
- üîí Invoice (facturas del cliente)
- üîí PartPriceHistory (precios pagados por el cliente)
- üîí Supplier (proveedores del cliente)
- üîí MantItem personalizados (modificaciones espec√≠ficas)

### Flujo de Creaci√≥n de Datos Globales:

```typescript
// Al crear MasterPart, admin decide:

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Nuevo Art√≠culo: Filtro BOSCH-123           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  [x] Compartir con otros usuarios           ‚îÇ
‚îÇ      Este art√≠culo es gen√©rico y puede      ‚îÇ
‚îÇ      beneficiar a otras empresas            ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  [ ] Mantener privado                       ‚îÇ
‚îÇ      Este art√≠culo es espec√≠fico de         ‚îÇ
‚îÇ      mi empresa                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

// Si marca "Compartir":
await prisma.masterPart.create({
  data: {
    code: "BOSCH-123",
    description: "Filtro aceite motor BOSCH",
    tenantId: null  // ‚Üê GLOBAL
  }
})

// Si marca "Privado":
await prisma.masterPart.create({
  data: {
    code: "CUSTOM-FILTER-XYZ",
    description: "Filtro modificado para nuestros veh√≠culos",
    tenantId: "tenant-abc"  // ‚Üê PRIVADO
  }
})
```

### Beneficios Medibles:

| M√©trica | Empresa 1 | Empresa 2 | Empresa 10 |
|---------|-----------|-----------|------------|
| Tiempo onboarding | 8 horas | 2 horas | 30 minutos |
| MasterParts a cargar | 150 | 20 | 5 |
| Templates a configurar | 8 | 2 | 0 |
| Tiempo hasta productivo | 1 semana | 1 d√≠a | 2 horas |

**ROI para Fleet Care**:
- Empresa 1: 8h trabajo manual
- Empresa 10: 0.5h trabajo manual
- **Eficiencia: 1,600% mejora en onboarding**

---

## üíé Killer Features para Pitch de Ventas

### 1. ü§ñ IA Sugiere Ahorros (FASE 3)

**Ejemplo visual para demo**:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ü§ñ OPORTUNIDADES DE AHORRO DETECTADAS                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                               ‚îÇ
‚îÇ 1. üí∞ Cambiar de proveedor en filtros                        ‚îÇ
‚îÇ    Proveedor actual (AutoServicio XYZ): $45,000/unidad      ‚îÇ
‚îÇ    Proveedor sugerido (Repuestos ABC): $42,000/unidad       ‚îÇ
‚îÇ    Frecuencia: 30 cambios/a√±o                                ‚îÇ
‚îÇ    AHORRO ANUAL: $90,000                                      ‚îÇ
‚îÇ    [Ver Detalle] [Aplicar Sugerencia]                        ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ 2. üîß Usar aceite sint√©tico de larga duraci√≥n                ‚îÇ
‚îÇ    Actual: Cambio cada 5,000 km ($140,000)                   ‚îÇ
‚îÇ    Sugerido: Cambio cada 10,000 km ($180,000)                ‚îÇ
‚îÇ    Ahorro: -2 cambios/a√±o por veh√≠culo                       ‚îÇ
‚îÇ    AHORRO ANUAL (flota 30 veh): $420,000                     ‚îÇ
‚îÇ    [Ver An√°lisis T√©cnico]                                    ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ 3. ‚ö†Ô∏è Prevenir correctivos con preventivo proactivo          ‚îÇ
‚îÇ    Detectamos 12 correctivos evitables en 2025               ‚îÇ
‚îÇ    Costo correctivos: $3,200,000                             ‚îÇ
‚îÇ    Costo preventivo: $480,000                                ‚îÇ
‚îÇ    AHORRO POTENCIAL: $2,720,000                              ‚îÇ
‚îÇ    [Ver Casos]                                                ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ üéØ AHORRO TOTAL ANUAL: $3,230,000                            ‚îÇ
‚îÇ                                                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2. üìä Comparador de TCO por Marca (FASE 2)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üìä TOTAL COST OF OWNERSHIP (TCO) - 2025                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                               ‚îÇ
‚îÇ Toyota Hilux (30 veh√≠culos)                                   ‚îÇ
‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë $2,100,000/a√±o (promedio)    ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ Nissan Frontier (15 veh√≠culos)                                ‚îÇ
‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë $2,800,000/a√±o (promedio)    ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ Chevrolet Colorado (5 veh√≠culos)                              ‚îÇ
‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà $3,100,000/a√±o (promedio)    ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ üí° INSIGHT:                                                   ‚îÇ
‚îÇ Toyota es 33% m√°s econ√≥mico que Nissan                        ‚îÇ
‚îÇ En renovaci√≥n de flota, priorizar Toyota                      ‚îÇ
‚îÇ Ahorro potencial al unificar flota: $1,200,000/a√±o           ‚îÇ
‚îÇ                                                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 3. üîç Auditor√≠a Completa de Gastos (MVP)

```sql
-- Query que responde: "¬øQui√©n autoriz√≥ todas las compras de filtros en 2025?"

SELECT
  i.invoiceNumber,
  i.invoiceDate,
  s.name AS proveedor,
  mp.description AS articulo,
  ii.quantity,
  ii.unitPrice,
  ii.total,
  u1.name AS autorizado_por,
  u2.name AS registrado_por
FROM Invoice i
JOIN InvoiceItem ii ON i.id = ii.invoiceId
JOIN MasterPart mp ON ii.masterPartId = mp.id
JOIN Supplier s ON i.supplierId = s.id
LEFT JOIN User u1 ON i.approvedBy = u1.id
LEFT JOIN User u2 ON i.registeredBy = u2.id
WHERE mp.category = 'FILTROS'
  AND YEAR(i.invoiceDate) = 2025
ORDER BY i.invoiceDate DESC;
```

**Output visual**:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Factura  ‚îÇ Fecha      ‚îÇ Proveedor    ‚îÇ Art√≠culo    ‚îÇ Cant   ‚îÇ Precio  ‚îÇ Autoriz√≥   ‚îÇ Registr√≥   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ F-001234 ‚îÇ 2025-10-10 ‚îÇ AutoServ XYZ ‚îÇ BOSCH-123   ‚îÇ 1      ‚îÇ $45,000 ‚îÇ Juan P√©rez ‚îÇ Ana Garc√≠a ‚îÇ
‚îÇ F-001189 ‚îÇ 2025-09-15 ‚îÇ Repuestos ABC‚îÇ BOSCH-123   ‚îÇ 1      ‚îÇ $42,000 ‚îÇ Juan P√©rez ‚îÇ Ana Garc√≠a ‚îÇ
‚îÇ F-001087 ‚îÇ 2025-08-20 ‚îÇ AutoServ XYZ ‚îÇ MANN-456    ‚îÇ 2      ‚îÇ $38,000 ‚îÇ Mar√≠a L√≥pez‚îÇ Carlos Ruiz‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

üí° INSIGHT: AutoServicio XYZ cobra 7% m√°s que Repuestos ABC en BOSCH-123
```

---

## üìã Plan de Implementaci√≥n - Roadmap

### ‚úÖ FASE 1: MVP (Sprint 1.5) - 3 d√≠as
**Objetivo**: Cerrar ciclo preventivo b√°sico

**Tareas**:
1. ‚úÖ Migraci√≥n Prisma con modelos base:
   - MasterPart (b√°sico)
   - MantItem.type + technicalNotes
   - MantItemPart (tabla intermedia)
   - Invoice + InvoiceItem
   - PartPriceHistory

2. ‚úÖ CRUD MasterPart (admin):
   - Listar art√≠culos
   - Crear art√≠culo (con flag global/privado)
   - Editar art√≠culo
   - Buscar por c√≥digo/descripci√≥n

3. ‚úÖ Modificar CreateWorkOrderModal:
   - Mostrar `technicalNotes` en preview
   - Mostrar `recommendedParts` (lista de art√≠culos)

4. ‚úÖ Pantalla registro de factura:
   - Crear Invoice (header)
   - Agregar InvoiceItems
   - Vincular con MasterPart (dropdown con search)
   - Vincular con WorkOrderItem (opcional)
   - Auto-crear PartPriceHistory (trigger)

5. ‚úÖ Reporte b√°sico: "Hist√≥rico de precios por art√≠culo"

**Entregables**:
- Admin puede registrar facturas
- Sistema trackea precios hist√≥ricos
- Flujo completo: Alerta ‚Üí WO ‚Üí Factura ‚Üí Analytics

---

### üöß FASE 2: Analytics Premium (Sprint 2-3) - 5 d√≠as
**Objetivo**: Reportes que venden el software

**Tareas**:
1. Dashboard "Cost Analytics":
   - TCO por veh√≠culo
   - TCO por marca/modelo
   - Gastos por categor√≠a (filtros, aceites, frenos, etc.)
   - Top 5 veh√≠culos m√°s costosos
   - Top 5 proveedores m√°s caros

2. Comparador de proveedores:
   - Lista art√≠culos
   - Muestra precio por proveedor
   - Ordena por precio ascendente
   - Calcula ahorro potencial

3. InvoicePayment (control financiero):
   - Registrar pagos
   - Estado: Pending ‚Üí Approved ‚Üí Paid
   - Facturas vencidas (overdue)

4. Importador de cat√°logo CSV:
   - Subir CSV con art√≠culos
   - Parsear y crear MasterParts
   - Validaci√≥n de duplicados

**Entregables**:
- Reportes accionables para CEO/CFO
- Comparaci√≥n de proveedores funcional
- Control financiero de facturas

---

### ü§ñ FASE 3: IA y Optimizaci√≥n (Sprint 4+) - 8 d√≠as
**Objetivo**: Diferenciador absoluto vs competencia

**Tareas**:
1. PartCompatibility:
   - Definir compatibilidades por veh√≠culo
   - Sugerir alternativas al crear WO
   - "Este veh√≠culo tambi√©n puede usar: [lista]"

2. Motor de recomendaciones b√°sico (reglas):
   - Detectar proveedor m√°s caro en categor√≠a ‚Üí Sugerir cambio
   - Detectar correctivos recurrentes ‚Üí Sugerir preventivo
   - Detectar desviaci√≥n estimado vs real ‚Üí Ajustar templates

3. OCR facturas (Tesseract.js o API externa):
   - Subir foto/PDF de factura
   - Extraer: n√∫mero, fecha, proveedor, items, totales
   - Pre-llenar formulario Invoice

4. Integraci√≥n ERP (API):
   - Importar facturas desde contabilidad
   - Exportar √≥rdenes de trabajo a ERP

**Entregables**:
- Sistema "inteligente" que sugiere ahorros
- Onboarding ultra-r√°pido con compatibilidades
- OCR reduce carga manual 80%

---

## üéØ M√©tricas de √âxito (KPIs)

### Para el MVP:
- ‚úÖ Usuario puede registrar factura completa en < 3 minutos
- ‚úÖ Sistema genera PartPriceHistory autom√°ticamente
- ‚úÖ Reporte "Hist√≥rico de precios" funcional
- ‚úÖ Flujo completo sin errores: Alerta ‚Üí WO ‚Üí Factura

### Para Analytics (Fase 2):
- ‚úÖ Dashboard muestra TCO por veh√≠culo
- ‚úÖ Comparador detecta proveedor m√°s barato
- ‚úÖ CEO puede responder: "¬øCu√°nto gastamos en filtros en 2025?"

### Para IA (Fase 3):
- ‚úÖ Sistema sugiere al menos 1 oportunidad de ahorro por mes
- ‚úÖ OCR extrae datos de factura con 80% precisi√≥n
- ‚úÖ Onboarding de empresa nueva < 2 horas (vs 8 horas sin IA)

---

## üî• Conversaciones T√©cnicas Clave

### 1. ¬øPor qu√© MantItemPart (many-to-many) y no FK directo?
**Raz√≥n**: Flexibilidad para items complejos.
- "Cambio aceite motor" = aceite + filtro + arandela (3 art√≠culos)
- "Mantenimiento 5,000 km" = 8-10 art√≠culos
- Sin tabla intermedia ‚Üí imposible modelar

### 2. ¬øPor qu√© PartPriceHistory en lugar de actualizar precio en Invoice?
**Raz√≥n**: An√°lisis temporal y comparaci√≥n.
- Detectar aumentos abusivos: "Proveedor subi√≥ 15% en 2 meses"
- Comparar precios entre proveedores en el tiempo
- Responder: "¬øCu√°ndo pagamos menos por este art√≠culo?"

### 3. ¬øPor qu√© MasterPart.tenantId nullable?
**Raz√≥n**: Datos compartidos globalmente.
- Filtro BOSCH-123 es igual para todos
- No duplicar datos en cada tenant
- Primera empresa carga ‚Üí todas se benefician

### 4. ¬øPor qu√© InvoiceItem.masterPartId nullable?
**Raz√≥n**: Onboarding progresivo.
- Admin puede registrar factura SIN vincular a cat√°logo inicialmente
- Luego vincula (o sistema sugiere)
- No bloquear registro por falta de cat√°logo completo

### 5. ¬øPor qu√© technicalNotes en MantItem Y MaintenanceAlert?
**Raz√≥n**: Herencia con override.
- MantItem.technicalNotes = recomendaci√≥n gen√©rica
- MaintenanceAlert.technicalNotes = copia al generar
- MaintenanceAlert.customNotes = override espec√≠fico del caso
- T√©cnico ve: gen√©rico + espec√≠fico

---

## üö® Riesgos y Mitigaciones

### Riesgo 1: Sobrecarga de carga inicial
**Problema**: Admin debe cargar 100+ MasterParts antes de usar sistema.
**Mitigaci√≥n**:
- MasterPart.tenantId = NULL (datos compartidos)
- Importador CSV
- OCR facturas (auto-crea art√≠culos)
- Permitir registro sin cat√°logo (InvoiceItem.masterPartId nullable)

### Riesgo 2: Datos incorrectos en PartPriceHistory
**Problema**: Admin vincula art√≠culo equivocado ‚Üí analytics err√≥neos.
**Mitigaci√≥n**:
- Validaci√≥n en UI: "¬øSeguro que este art√≠culo cuesta $5M?" (outlier detection)
- Auditor√≠a: campo `approvedBy` para rastrear errores
- Edici√≥n posterior de InvoiceItem (con log de cambios)

### Riesgo 3: Complejidad del schema asusta a desarrolladores
**Problema**: Schema extenso puede ser intimidante.
**Mitigaci√≥n**:
- Documentaci√≥n visual (diagramas ER)
- Implementaci√≥n incremental (Fase 1 ‚Üí 2 ‚Üí 3)
- C√≥digo comentado en modelos Prisma

---

## üìû Pr√≥ximos Pasos Inmediatos

**HOY (10-Oct)**:
1. ‚úÖ Documentar este an√°lisis (HECHO - este archivo)
2. üöß Dise√±ar schema Prisma completo
3. üöß Crear migraci√≥n base (MasterPart, Invoice, etc.)
4. üöß Implementar seed con datos de ejemplo

**MA√ëANA (11-Oct)**:
1. CRUD MasterPart (admin)
2. Modificar CreateWorkOrderModal (mostrar technicalNotes)
3. Pantalla registro Invoice (b√°sica)

**LUNES (14-Oct)**:
1. Vincular InvoiceItem con MasterPart
2. Auto-crear PartPriceHistory (trigger)
3. Reporte b√°sico "Hist√≥rico de precios"

---

## üíé Resumen Ejecutivo (para Pitch)

### Problema del Cliente:
> "No s√© cu√°nto gasto en mantenimiento ni d√≥nde optimizar costos"

### Soluci√≥n Fleet Care:
> "Sistema que trackea cada peso gastado y sugiere c√≥mo ahorrar millones"

### Diferenciadores:
1. ü§ñ **IA sugiere ahorros concretos** - No solo muestra datos, ACT√öA
2. üìä **TCO por marca/modelo** - ¬øToyota o Nissan? Datos objetivos
3. üîç **Auditor√≠a completa** - Qui√©n autoriz√≥, cu√°ndo, cu√°nto, por qu√©
4. ‚ö° **Onboarding instant√°neo** - Datos compartidos entre clientes
5. üí∞ **ROI medible** - "Ahorramos $3.2M/a√±o cambiando proveedor"

### Tecnolog√≠a Invisible:
- El cliente no ve: Prisma, MantItemPart, PartPriceHistory
- El cliente ve: "Tu flota Toyota es 33% m√°s eficiente que Nissan"

---

**Estado**: Arquitectura definida, lista para implementar ‚úÖ
**Pr√≥xima sesi√≥n**: Implementaci√≥n schema + migraci√≥n + CRUD b√°sico
